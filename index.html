<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Weather Stylist</title>
    <link rel="icon" href="data:,">

    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š --- */
        body {
            margin: 0; padding: 0;
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
            background-color: #eef2f5;
            display: flex; justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 420px;
            height: 100%;
            /* åˆæœŸã‚«ãƒ©ãƒ¼ï¼ˆèª­ã¿è¾¼ã¿å¾Œã«ä¸Šæ›¸ãã•ã‚Œã¾ã™ï¼‰ */
            background: linear-gradient(180deg, #89f7fe 0%, #66a6ff 100%);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
            transition: background 1.0s ease; /* â˜…è‰²ãŒãµã‚ã£ã¨å¤‰ã‚ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        /* ä¸ŠåŠåˆ†ï¼šå¤©æ°—ã‚¨ãƒªã‚¢ */
        .weather-section {
            flex: 1.5; 
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 10px;
        }

        .date-display {
            font-size: 14px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 5px;
            background: rgba(0,0,0,0.2); /* èƒŒæ™¯ã‚’å°‘ã—æ¿ƒãã—ã¦æ–‡å­—ã‚’è¦‹ã‚„ã™ã */
            padding: 4px 12px;
            border-radius: 15px;
        }

        .weather-icon {
            font-size: 90px;
            margin: 0;
            margin-bottom: 10px; 
            line-height: 1.2;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            z-index: 2;
        }

        .weather-desc-text {
            font-size: 22px;
            font-weight: bold;
            color: #fff;
            margin-top: 0;
            margin-bottom: 5px;
            text-shadow: 0 1px 5px rgba(0,0,0,0.3); /* å½±ã‚’å¼·ãã—ã¦ã©ã®èƒŒæ™¯ã§ã‚‚èª­ã‚ã‚‹ã‚ˆã†ã« */
            z-index: 1;
        }

        .temperature {
            font-size: 64px;
            font-weight: bold;
            color: #fff;
            line-height: 1;
            margin-bottom: 10px;
            text-shadow: 0 2px 15px rgba(0,0,0,0.2);
            font-feature-settings: "palt";
        }

        .weather-details {
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            gap: 15px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 10px;
            margin-bottom: 40px; 
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .weather-details span {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        /* ä¸‹åŠåˆ†ï¼šã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¨ãƒªã‚¢ */
        .advice-card {
            flex: 2.5;
            width: 100%;
            background-color: #ffffff;
            border-radius: 30px 30px 0 0;
            padding: 25px 25px 40px 25px;
            box-sizing: border-box;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            flex-shrink: 0;
        }

        .advice-text {
            font-size: 16px;
            line-height: 1.8;
            color: #444;
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>

    <div class="app-container" id="app-bg">
        <div class="weather-section">
            <div class="date-display" id="date-area">--æœˆ--æ—¥</div>
            <div class="weather-icon" id="weather-icon">ğŸ¤”</div>
            <div class="weather-desc-text" id="weather-desc">...</div>
            <div class="temperature" id="temp-display">--â„ƒ</div>
            <div class="weather-details">
                <span id="max-temp">æœ€é«˜:--â„ƒ</span>
                <span id="min-temp">æœ€ä½:--â„ƒ</span>
                <span id="humidity">ğŸ’§--%</span>
            </div>
        </div>

        <div class="advice-card">
            <div class="card-title">
                ğŸ‘• ä»Šæ—¥ã®ã‚³ãƒ¼ãƒ‡ææ¡ˆ
            </div>
            <div class="advice-text" id="advice-text">
                èª­ã¿è¾¼ã¿ä¸­...
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // GAS URL
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzatY9Wut61m80qjZqYLM2AHt04xKmGaRo1dOwk3zonVBd5hec5GbCuWKf6wbxbX3jx/exec"; 
        // ==========================================

        function updateDate() {
            const now = new Date();
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            document.getElementById('date-area').innerText = 
                `${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥ (${days[now.getDay()]})`;
        }
        updateDate();

        function getEmoji(iconCode) {
            const map = {
                '01d': 'â˜€ï¸', '01n': 'ğŸŒ™', 
                '02d': 'ğŸŒ¤ï¸', '02n': 'â˜ï¸', 
                '03d': 'â˜ï¸', '03n': 'â˜ï¸', 
                '04d': 'â˜ï¸', '04n': 'â˜ï¸', 
                '09d': 'â˜”', '09n': 'â˜”', 
                '10d': 'â˜”', '10n': 'â˜”', 
                '11d': 'âš¡', '11n': 'âš¡', 
                '13d': 'â›„', '13n': 'â›„', 
                '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'  
            };
            return map[iconCode] || 'ğŸ¤”';
        }

        // â˜…è¿½åŠ æ©Ÿèƒ½ï¼šå¤©æ°—ã«åˆã‚ã›ã¦èƒŒæ™¯è‰²ã‚’å¤‰ãˆã‚‹é–¢æ•°
        function changeBackground(iconCode) {
            const bgElement = document.getElementById('app-bg');
            let gradient = "";

            // ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ¼ãƒ‰ã®æœ«å°¾ (d=æ˜¼, n=å¤œ) ã¨ å…ˆé ­2æ–‡å­—(å¤©æ°—ç¨®åˆ¥) ã§åˆ¤å®š
            const isNight = iconCode.includes('n');
            const type = iconCode.substring(0, 2);

            if (isNight) {
                // å¤œã®å ´åˆã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
                if (type === '01' || type === '02') {
                    // æ™´ã‚Œãƒ»è–„æ›‡ã‚Šã®å¤œï¼šæ·±ã„ãƒã‚¤ãƒ“ãƒ¼ï¼ˆæ˜Ÿç©ºã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
                    gradient = "linear-gradient(180deg, #0F2027 0%, #203A43 50%, #2C5364 100%)";
                } else if (['09', '10', '11'].includes(type)) {
                    // é›¨ãƒ»é›·ã®å¤œï¼šæš—ã„ç´«ã‚°ãƒ¬ãƒ¼
                    gradient = "linear-gradient(180deg, #232526 0%, #414345 100%)";
                } else {
                    // æ›‡ã‚Šãªã©ã®å¤œï¼šãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼
                    gradient = "linear-gradient(180deg, #3a3d40 0%, #181719 100%)";
                }
            } else {
                // æ˜¼ã®å ´åˆã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
                if (type === '01') {
                    // å¿«æ™´ï¼šé®®ã‚„ã‹ãªé’ç©º
                    gradient = "linear-gradient(180deg, #2980B9 0%, #6DD5FA 100%)"; // ã¾ãŸã¯ä»Šã® #89f7feç³»
                } else if (type === '02' || type === '03' || type === '04') {
                    // æ›‡ã‚Šï¼šè½ã¡ç€ã„ãŸãƒ–ãƒ«ãƒ¼ã‚°ãƒ¬ãƒ¼
                    gradient = "linear-gradient(180deg, #8e9eab 0%, #eef2f3 100%)";
                } else if (['09', '10', '11'].includes(type)) {
                    // é›¨ï¼šã©ã‚“ã‚ˆã‚Šã—ãŸæ·±ã„é’
                    gradient = "linear-gradient(180deg, #4b6cb7 0%, #182848 100%)";
                } else if (type === '13') {
                    // é›ªï¼šæ°·ã®ã‚ˆã†ãªç™½éŠ€
                    gradient = "linear-gradient(180deg, #E0EAFC 0%, #CFDEF3 100%)";
                } else {
                    // ãã®ä»–ï¼ˆéœ§ãªã©ï¼‰ï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é’
                    gradient = "linear-gradient(180deg, #89f7fe 0%, #66a6ff 100%)";
                }
            }

            // èƒŒæ™¯ã‚’é©ç”¨
            bgElement.style.background = gradient;
        }

        async function startApp() {
            try {
                const res = await fetch(`${GAS_URL}?city=Tokyo`);
                if (!res.ok) throw new Error("æ¥ç¶šã‚¨ãƒ©ãƒ¼");
                const data = await res.json();

                if (data.error) throw new Error(data.error);

                document.getElementById('temp-display').innerText = `${data.temp}â„ƒ`;
                document.getElementById('weather-desc').innerText = data.weatherDesc;
                document.getElementById('max-temp').innerText = `æœ€é«˜:${data.max}â„ƒ`;
                document.getElementById('min-temp').innerText = `æœ€ä½:${data.min}â„ƒ`;
                document.getElementById('humidity').innerText = `ğŸ’§${data.humidity}%`;
                
                const emoji = getEmoji(data.icon);
                document.getElementById('weather-icon').innerText = emoji;
                
                // â˜…ã“ã“ã§èƒŒæ™¯è‰²ã‚’å¤‰æ›´ï¼
                changeBackground(data.icon);

                document.getElementById('advice-text').innerText = data.advice;

            } catch (error) {
                console.error(error);
                document.getElementById('advice-text').innerText = "ã‚¨ãƒ©ãƒ¼: " + error.message;
            }
        }

        startApp();
    </script>
</body>
</html>